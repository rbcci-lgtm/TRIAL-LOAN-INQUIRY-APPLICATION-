<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>RBCCI ‚Äî Loan Inquiry Platform 2026</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600;9..40,700&display=swap" rel="stylesheet" />
<style>
  :root {
    --green: #0b6b35;
    --green-mid: #138a43;
    --green-light: #e8f5ee;
    --green-glow: rgba(11,107,53,0.15);
    --gold: #c9973a;
    --gold-light: #fdf4e3;
    --bg: #f4f6f3;
    --card: #ffffff;
    --text: #111813;
    --muted: #5a6a5e;
    --border: #d5ddd6;
    --shadow: 0 2px 16px rgba(11,107,53,0.08);
    --radius: 16px;
  }
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
  }

  /* ‚îÄ‚îÄ HERO HEADER ‚îÄ‚îÄ */
  .hero {
    background: linear-gradient(145deg, #0a4d27 0%, #0b6b35 50%, #127a3d 100%);
    color: white;
    padding: 0;
    position: relative;
    overflow: hidden;
  }
  .hero::before {
    content: '';
    position: absolute; inset: 0;
    background:
      radial-gradient(ellipse at 80% 20%, rgba(201,151,58,0.18) 0%, transparent 55%),
      radial-gradient(ellipse at 10% 80%, rgba(255,255,255,0.06) 0%, transparent 50%);
  }
  .hero-inner {
    position: relative;
    max-width: 1100px;
    margin: 0 auto;
    padding: 42px 28px 36px;
    display: flex;
    align-items: center;
    gap: 22px;
  }
  .bank-logo {
    width: 68px; height: 68px;
    background: rgba(255,255,255,0.12);
    border: 2px solid rgba(255,255,255,0.25);
    border-radius: 18px;
    display: flex; align-items: center; justify-content: center;
    font-family: 'DM Serif Display', serif;
    font-size: 22px; font-weight: 400;
    color: var(--gold);
    flex-shrink: 0;
    backdrop-filter: blur(8px);
  }
  .hero-text h1 {
    font-family: 'DM Serif Display', serif;
    font-size: 28px; font-weight: 400;
    line-height: 1.2;
    letter-spacing: -0.3px;
  }
  .hero-text p {
    margin-top: 6px;
    font-size: 13.5px;
    color: rgba(255,255,255,0.72);
    font-weight: 300;
    line-height: 1.5;
  }
  .hero-badge {
    margin-left: auto;
    background: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 40px;
    padding: 6px 14px;
    font-size: 12px;
    color: rgba(255,255,255,0.8);
    white-space: nowrap;
    backdrop-filter: blur(6px);
  }
  .hero-badge span { color: var(--gold); font-weight: 600; }

  /* ‚îÄ‚îÄ AI ASSISTANT BAR ‚îÄ‚îÄ */
  .ai-bar {
    background: white;
    border-bottom: 1px solid var(--border);
    padding: 0;
  }
  .ai-bar-inner {
    max-width: 1100px; margin: 0 auto;
    padding: 14px 28px;
    display: flex; align-items: center; gap: 12px;
  }
  .ai-icon {
    width: 36px; height: 36px; border-radius: 10px;
    background: linear-gradient(135deg, var(--green), var(--green-mid));
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
  }
  .ai-icon svg { width: 18px; height: 18px; fill: white; }
  .ai-input-wrap {
    flex: 1;
    display: flex; align-items: center;
    background: var(--bg);
    border: 1.5px solid var(--border);
    border-radius: 12px;
    padding: 0 14px;
    gap: 10px;
    transition: border-color .2s;
  }
  .ai-input-wrap:focus-within { border-color: var(--green); }
  .ai-input-wrap input {
    flex: 1; border: none; background: transparent;
    padding: 10px 0; font-size: 14px; outline: none;
    font-family: 'DM Sans', sans-serif;
    color: var(--text);
  }
  .ai-input-wrap input::placeholder { color: var(--muted); }
  .ai-send {
    background: var(--green); color: white;
    border: none; border-radius: 8px;
    padding: 7px 14px; font-size: 13px; font-weight: 600;
    cursor: pointer; transition: background .2s;
    font-family: 'DM Sans', sans-serif;
    white-space: nowrap;
  }
  .ai-send:hover { background: var(--green-mid); }

  /* ‚îÄ‚îÄ CHAT BUBBLE AREA ‚îÄ‚îÄ */
  #chat-area {
    max-width: 1100px; margin: 0 auto;
    padding: 0 28px;
    display: none; flex-direction: column; gap: 10px;
  }
  #chat-area.visible { display: flex; padding-top: 16px; padding-bottom: 8px; }
  .bubble {
    max-width: 75%; padding: 12px 16px;
    border-radius: 14px; font-size: 14px; line-height: 1.6;
    animation: fadeUp .25s ease;
  }
  .bubble.user {
    background: var(--green); color: white;
    align-self: flex-end; border-bottom-right-radius: 4px;
  }
  .bubble.ai {
    background: white; color: var(--text);
    border: 1px solid var(--border);
    align-self: flex-start; border-bottom-left-radius: 4px;
  }
  .bubble.ai strong { color: var(--green); }
  .bubble.thinking {
    background: white; border: 1px solid var(--border);
    align-self: flex-start; color: var(--muted);
    font-style: italic; display: flex; align-items: center; gap: 8px;
  }
  .dots span {
    display: inline-block; width: 6px; height: 6px;
    background: var(--muted); border-radius: 50%;
    animation: bounce .8s infinite;
  }
  .dots span:nth-child(2) { animation-delay: .15s; }
  .dots span:nth-child(3) { animation-delay: .3s; }
  @keyframes bounce { 0%,80%,100%{transform:translateY(0)} 40%{transform:translateY(-5px)} }
  @keyframes fadeUp { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:translateY(0)} }

  /* ‚îÄ‚îÄ MAIN LAYOUT ‚îÄ‚îÄ */
  .main { max-width: 1100px; margin: 0 auto; padding: 24px 28px 60px; }
  .progress-bar-wrap { margin-bottom: 20px; }
  .progress-steps {
    display: flex; gap: 6px; align-items: center;
  }
  .step-pill {
    display: flex; align-items: center; gap: 6px;
    font-size: 12px; font-weight: 500;
    color: var(--muted); cursor: pointer;
    transition: color .2s;
  }
  .step-pill.active { color: var(--green); }
  .step-pill.done { color: var(--green-mid); }
  .step-dot {
    width: 26px; height: 26px; border-radius: 50%;
    background: var(--border); color: var(--muted);
    display: flex; align-items: center; justify-content: center;
    font-size: 11px; font-weight: 700;
    transition: all .3s;
    border: 2px solid transparent;
  }
  .step-pill.active .step-dot {
    background: var(--green); color: white;
    box-shadow: 0 0 0 3px var(--green-glow);
  }
  .step-pill.done .step-dot {
    background: var(--green-light); color: var(--green); border-color: var(--green);
  }
  .step-line { flex: 1; height: 2px; background: var(--border); border-radius: 2px; min-width: 20px; }
  .step-line.done { background: var(--green); }

  /* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
  .card {
    background: var(--card); border: 1px solid var(--border);
    border-radius: var(--radius); padding: 28px;
    box-shadow: var(--shadow); margin-bottom: 18px;
    display: none;
  }
  .card.active { display: block; animation: fadeUp .3s ease; }
  .card-header {
    display: flex; align-items: center; gap: 14px; margin-bottom: 24px;
  }
  .card-icon {
    width: 44px; height: 44px; border-radius: 12px;
    background: var(--green-light);
    display: flex; align-items: center; justify-content: center;
    font-size: 20px; flex-shrink: 0;
  }
  .card-header h2 { font-family: 'DM Serif Display', serif; font-size: 20px; font-weight: 400; }
  .card-header p { font-size: 13px; color: var(--muted); margin-top: 2px; }

  /* ‚îÄ‚îÄ FORM ELEMENTS ‚îÄ‚îÄ */
  .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 18px; }
  .form-grid.single { grid-template-columns: 1fr; }
  .field { display: flex; flex-direction: column; gap: 6px; }
  .field.full { grid-column: 1 / -1; }
  label {
    font-size: 13px; font-weight: 600; color: var(--text);
  }
  .label-waray { font-weight: 400; color: var(--muted); font-style: italic; font-size: 12px; }
  .req { color: var(--green); }
  input[type="text"], input[type="email"], input[type="tel"],
  select, textarea {
    border: 1.5px solid var(--border); border-radius: 10px;
    padding: 10px 13px; font-size: 14px; outline: none;
    background: white; font-family: 'DM Sans', sans-serif;
    color: var(--text); transition: border-color .2s, box-shadow .2s;
    width: 100%;
  }
  input:focus, select:focus, textarea:focus {
    border-color: var(--green);
    box-shadow: 0 0 0 3px var(--green-glow);
  }
  textarea { min-height: 90px; resize: vertical; }
  select { cursor: pointer; appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%235a6a5e' fill='none' stroke-width='1.5' stroke-linecap='round'/%3E%3C/svg%3E");
    background-repeat: no-repeat; background-position: right 12px center;
    padding-right: 36px;
  }

  /* checkbox grid */
  .check-grid { display: grid; gap: 8px; margin-top: 4px; }
  .check-item {
    display: flex; align-items: flex-start; gap: 10px;
    padding: 11px 14px; border: 1.5px solid var(--border);
    border-radius: 10px; cursor: pointer; transition: all .2s;
    background: white;
  }
  .check-item:hover { border-color: var(--green); background: var(--green-light); }
  .check-item input[type="checkbox"] { margin-top: 2px; accent-color: var(--green); flex-shrink: 0; }
  .check-item.checked { border-color: var(--green); background: var(--green-light); }
  .check-label { font-size: 13.5px; line-height: 1.4; }
  .check-waray { display: block; font-size: 12px; color: var(--muted); font-style: italic; margin-top: 2px; }

  /* file upload */
  .upload-box {
    border: 2px dashed var(--border); border-radius: 12px;
    padding: 20px; text-align: center; cursor: pointer;
    transition: all .2s; background: var(--bg);
    position: relative;
  }
  .upload-box:hover { border-color: var(--green); background: var(--green-light); }
  .upload-box input[type="file"] {
    position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%;
    border: none; padding: 0;
  }
  .upload-box .upload-icon { font-size: 26px; margin-bottom: 8px; }
  .upload-box p { font-size: 13px; color: var(--muted); }
  .upload-box strong { color: var(--green); font-size: 13px; }
  .file-list { margin-top: 8px; display: flex; flex-wrap: wrap; gap: 6px; }
  .file-tag {
    background: var(--green-light); border: 1px solid var(--green);
    color: var(--green); font-size: 12px; border-radius: 20px;
    padding: 3px 10px; display: flex; align-items: center; gap: 6px;
  }
  .file-tag button { background: none; border: none; color: var(--green); cursor: pointer; font-size: 14px; line-height: 1; padding: 0; }

  /* info callout */
  .callout {
    background: var(--gold-light); border: 1px solid #e8c87a;
    border-radius: 10px; padding: 12px 16px;
    font-size: 13px; color: #7a5c10; line-height: 1.5;
    margin-bottom: 18px;
  }
  .callout strong { color: #5a430a; }

  /* ‚îÄ‚îÄ SECTION TOGGLE ‚îÄ‚îÄ */
  .section-toggle {
    background: var(--green-light); border: 1.5px solid var(--green);
    border-radius: 10px; padding: 12px 16px;
    display: flex; align-items: center; justify-content: space-between;
    cursor: pointer; margin-bottom: 14px;
    font-size: 14px; font-weight: 600; color: var(--green);
  }
  .toggle-arrow { transition: transform .3s; }
  .toggle-arrow.open { transform: rotate(180deg); }
  .collapsible { display: none; }
  .collapsible.open { display: block; }

  /* documentary list */
  .doc-list { margin: 0; padding: 0; list-style: none; }
  .doc-list li {
    padding: 9px 0; border-bottom: 1px solid var(--border);
    font-size: 13.5px; display: flex; gap: 10px; align-items: flex-start;
  }
  .doc-list li::before { content: '‚úì'; color: var(--green); font-weight: 700; flex-shrink: 0; margin-top: 1px; }
  .doc-list li:last-child { border-bottom: none; }
  .doc-waray { display: block; font-size: 12px; color: var(--muted); font-style: italic; }

  /* ‚îÄ‚îÄ NAVIGATION ‚îÄ‚îÄ */
  .nav-row {
    display: flex; justify-content: space-between; align-items: center;
    margin-top: 28px;
  }
  .btn {
    border: none; border-radius: 12px; padding: 12px 24px;
    font-family: 'DM Sans', sans-serif;
    font-size: 14px; font-weight: 600; cursor: pointer;
    transition: all .2s; display: flex; align-items: center; gap: 8px;
  }
  .btn-primary {
    background: var(--green); color: white;
    box-shadow: 0 4px 14px rgba(11,107,53,0.3);
  }
  .btn-primary:hover { background: var(--green-mid); transform: translateY(-1px); box-shadow: 0 6px 18px rgba(11,107,53,0.35); }
  .btn-ghost {
    background: white; color: var(--muted);
    border: 1.5px solid var(--border);
  }
  .btn-ghost:hover { border-color: var(--green); color: var(--green); }
  .btn-gold {
    background: var(--gold); color: white;
    box-shadow: 0 4px 14px rgba(201,151,58,0.3);
  }
  .btn-gold:hover { background: #b8862e; transform: translateY(-1px); }

  /* ‚îÄ‚îÄ SUCCESS SCREEN ‚îÄ‚îÄ */
  #success-screen {
    display: none; text-align: center; padding: 60px 20px;
    animation: fadeUp .4s ease;
  }
  .success-icon {
    width: 80px; height: 80px; border-radius: 50%;
    background: var(--green-light); border: 3px solid var(--green);
    display: flex; align-items: center; justify-content: center;
    font-size: 36px; margin: 0 auto 24px;
  }
  #success-screen h2 { font-family: 'DM Serif Display', serif; font-size: 28px; color: var(--green); margin-bottom: 10px; }
  #success-screen p { color: var(--muted); font-size: 15px; line-height: 1.6; max-width: 480px; margin: 0 auto 24px; }
  .ref-number {
    background: var(--green-light); border: 1px solid var(--green);
    border-radius: 12px; padding: 14px 24px; display: inline-block;
    font-family: 'DM Serif Display', serif; font-size: 22px; color: var(--green);
    letter-spacing: 2px; margin-bottom: 28px;
  }

  @media (max-width: 680px) {
    .form-grid { grid-template-columns: 1fr; }
    .hero-inner { flex-direction: column; align-items: flex-start; gap: 14px; }
    .hero-badge { margin-left: 0; }
    .main { padding: 16px 16px 50px; }
    .ai-bar-inner { padding: 12px 16px; }
    .card { padding: 18px; }
    .step-pill .step-name { display: none; }
  }

  /* scrollbar */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 6px; }
</style>
</head>
<body>

<!-- ‚îÄ‚îÄ HERO ‚îÄ‚îÄ -->
<header class="hero">
  <div class="hero-inner">
    <div class="bank-logo">RB</div>
    <div class="hero-text">
      <h1>Rural Bank of Calbayog City, Inc.</h1>
      <p>Loan Inquiry Form 2026 ¬∑ English / Waray ¬∑ Secured & Unsecured Loans</p>
    </div>
    <div class="hero-badge">ü§ñ <span>AI-Assisted</span> Platform</div>
  </div>
</header>

<!-- ‚îÄ‚îÄ AI ASSISTANT BAR ‚îÄ‚îÄ -->
<div class="ai-bar">
  <div class="ai-bar-inner">
    <div class="ai-icon">
      <svg viewBox="0 0 24 24"><path d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.38-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 0 2h-1v1a2 2 0 0 1-2 2v1a1 1 0 0 1-2 0v-1H7v1a1 1 0 0 1-2 0v-1a2 2 0 0 1-2-2v-1H2a1 1 0 0 1 0-2h1a7 7 0 0 1 7-7h1V5.73A2 2 0 0 1 10 4a2 2 0 0 1 2-2zm-3 9a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm6 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/></svg>
    </div>
    <div class="ai-input-wrap">
      <input type="text" id="ai-input" placeholder="Ask the AI assistant anything about the loan process... (e.g. 'What documents do I need for a secured loan?')" onkeydown="if(event.key==='Enter') sendAI()" />
      <button class="ai-send" onclick="sendAI()">Ask AI ‚Üó</button>
    </div>
  </div>
</div>

<!-- ‚îÄ‚îÄ CHAT AREA ‚îÄ‚îÄ -->
<div id="chat-area"></div>

<!-- ‚îÄ‚îÄ MAIN FORM ‚îÄ‚îÄ -->
<div class="main">

  <!-- PROGRESS STEPS -->
  <div class="progress-bar-wrap">
    <div class="progress-steps" id="progress-steps">
      <div class="step-pill active" onclick="goToStep(0)">
        <div class="step-dot">1</div>
        <span class="step-name">Customer Info</span>
      </div>
      <div class="step-line" id="line-0"></div>
      <div class="step-pill" onclick="goToStep(1)">
        <div class="step-dot">2</div>
        <span class="step-name">Loan Request</span>
      </div>
      <div class="step-line" id="line-1"></div>
      <div class="step-pill" onclick="goToStep(2)">
        <div class="step-dot">3</div>
        <span class="step-name">Collateral / Income</span>
      </div>
      <div class="step-line" id="line-2"></div>
      <div class="step-pill" onclick="goToStep(3)">
        <div class="step-dot">4</div>
        <span class="step-name">Documents</span>
      </div>
      <div class="step-line" id="line-3"></div>
      <div class="step-pill" onclick="goToStep(4)">
        <div class="step-dot">5</div>
        <span class="step-name">Consent & Submit</span>
      </div>
    </div>
  </div>

  <form id="main-form" novalidate>

  <!-- ‚îÄ‚îÄ STEP 1: CUSTOMER INFO ‚îÄ‚îÄ -->
  <div class="card active" id="step-0">
    <div class="card-header">
      <div class="card-icon">üë§</div>
      <div>
        <h2>A. Customer Information</h2>
        <p class="label-waray">Impormasyon han Kustomer</p>
      </div>
    </div>

    <div class="form-grid">
      <div class="field full">
        <label>Full Name <span class="req">*</span> <span class="label-waray">‚Äî Kompleto nga Ngaran</span></label>
        <input type="text" name="full_name" placeholder="Enter your full legal name" required />
      </div>
      <div class="field">
        <label>Mobile No. <span class="req">*</span> <span class="label-waray">‚Äî Numero han Selpon</span></label>
        <input type="tel" name="mobile" placeholder="+63 9XX XXX XXXX" required />
      </div>
      <div class="field">
        <label>Email <span class="label-waray">‚Äî (optional / opsyonal)</span></label>
        <input type="email" name="email" placeholder="yourname@email.com" />
      </div>
      <div class="field full">
        <label>Complete Address <span class="req">*</span> <span class="label-waray">‚Äî Kompleto nga Address</span></label>
        <textarea name="address" placeholder="Barangay, City/Municipality, Province..."></textarea>
      </div>
      <div class="field full">
        <label>Facebook Messenger <span class="req">*</span> <span class="label-waray">‚Äî Messenger (link/username)</span></label>
        <input type="text" name="messenger" placeholder="facebook.com/username or m.me/username" required />
      </div>
    </div>

    <div class="callout" style="margin-top:20px">
      <strong>üìå Note:</strong> Messenger is our primary contact channel for loan follow-ups. Please ensure your link or username is correct.<br/>
      <span class="label-waray">Importante: An Messenger an amon gagamiton para kontaken ka. Siguraduha nga tama an imong username.</span>
    </div>

    <!-- ID Upload -->
    <div style="margin-top:18px">
      <label style="font-size:14px;font-weight:600;margin-bottom:10px;display:block">Valid Government ID (Applicant) <span class="req">*</span> <span class="label-waray">‚Äî Valid nga ID han Aplikante</span></label>
      <div class="upload-box" id="upload-id-box">
        <input type="file" multiple accept="image/*,.pdf" onchange="handleFiles(this,'upload-id-list','upload-id-box')" />
        <div class="upload-icon">ü™™</div>
        <p><strong>Click or drag files here</strong></p>
        <p>Passport, Driver's License, SSS, UMID, PhilHealth, Voter's ID, etc.</p>
      </div>
      <div class="file-list" id="upload-id-list"></div>
    </div>

    <div class="nav-row">
      <span></span>
      <button type="button" class="btn btn-primary" onclick="nextStep(0)">Next: Loan Request ‚Üí</button>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ STEP 2: LOAN REQUEST ‚îÄ‚îÄ -->
  <div class="card" id="step-1">
    <div class="card-header">
      <div class="card-icon">üí∞</div>
      <div>
        <h2>B. Loan Request Details</h2>
        <p class="label-waray">Detalye han Pangaro nga Loan</p>
      </div>
    </div>

    <div class="form-grid">
      <div class="field full">
        <label>Loan Type <span class="req">*</span> <span class="label-waray">‚Äî Klase han Loan</span></label>
        <div class="check-grid" id="loan-type-checks">
          <label class="check-item" onclick="handleCheckToggle(this,'loan-type-checks',false); toggleSections()">
            <input type="radio" name="loan_type" value="secured" />
            <div class="check-label">
              <strong>Secured Loan (With Collateral)</strong>
              <span class="check-waray">May Kolateral ‚Äî backed by property, vehicle, or asset</span>
            </div>
          </label>
          <label class="check-item" onclick="handleCheckToggle(this,'loan-type-checks',false); toggleSections()">
            <input type="radio" name="loan_type" value="unsecured" />
            <div class="check-label">
              <strong>Unsecured Loan (No Collateral)</strong>
              <span class="check-waray">Waray Kolateral ‚Äî based on income and creditworthiness</span>
            </div>
          </label>
        </div>
      </div>
      <div class="field">
        <label>Desired Loan Amount (PHP) <span class="req">*</span> <span class="label-waray">‚Äî Pila an Loan</span></label>
        <input type="text" name="loan_amount" placeholder="e.g. 50,000" required oninput="this.value=this.value.replace(/[^0-9,]/g,'')" />
      </div>
      <div class="field">
        <label>Preferred Term <span class="req">*</span> <span class="label-waray">‚Äî Pila ka bulan?</span></label>
        <select name="loan_term" required>
          <option value="">Select term...</option>
          <option>3 months / 3 ka bulan</option>
          <option>6 months / 6 ka bulan</option>
          <option>12 months / 12 ka bulan</option>
          <option>18 months / 18 ka bulan</option>
          <option>24 months / 24 ka bulan</option>
          <option>36 months / 36 ka bulan</option>
          <option>Other / Iba</option>
        </select>
      </div>
      <div class="field full">
        <label>Loan Purpose <span class="req">*</span> <span class="label-waray">‚Äî Para ha ano an Loan?</span></label>
        <select name="loan_purpose" required>
          <option value="">Select purpose...</option>
          <option>Business capital / Puhunan</option>
          <option>Home improvement / Pagpabaylo han balay</option>
          <option>Education / Edukasyon</option>
          <option>Medical / Medikal</option>
          <option>Agriculture / Agrikultura</option>
          <option>Vehicle purchase / Palit han sasakyan</option>
          <option>Debt consolidation / Pag-ayo han mga utang</option>
          <option>Personal / Pansarili</option>
          <option>Others / Iba pa</option>
        </select>
      </div>
      <div class="field full">
        <label>How did you hear about RBCCI loans? <span class="label-waray">‚Äî Paano mo nahibal-an?</span></label>
        <select name="referral">
          <option value="">Select source...</option>
          <option>Facebook / Social Media</option>
          <option>Friend or family referral / Kagawas o kamag-anak</option>
          <option>Existing client / Kustomer na</option>
          <option>Bank staff / Empleyado han bangko</option>
          <option>Barangay announcement / Balita ha barangay</option>
          <option>Flyer / Poster</option>
          <option>Other / Iba pa</option>
        </select>
      </div>
    </div>

    <div class="nav-row">
      <button type="button" class="btn btn-ghost" onclick="prevStep(1)">‚Üê Back</button>
      <button type="button" class="btn btn-primary" onclick="nextStep(1)">Next: Collateral / Income ‚Üí</button>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ STEP 3: SECURED / UNSECURED ‚îÄ‚îÄ -->
  <div class="card" id="step-2">
    <div class="card-header">
      <div class="card-icon">üè†</div>
      <div>
        <h2>C & D. Collateral / Income Details</h2>
        <p class="label-waray">Detalye han Kolateral / Kita</p>
      </div>
    </div>

    <!-- SECURED SECTION -->
    <div id="secured-section">
      <div class="callout">
        <strong>üìã Secured Loan Section</strong> ‚Äî Fill out below since you selected a secured loan.<br/>
        <span class="label-waray">C. Detalye han May Kolateral ‚Äî Pleteha ini kay nagin-pili mo an secured loan.</span>
      </div>

      <div class="form-grid">
        <div class="field full">
          <label>Collateral Type <span class="req">*</span> <span class="label-waray">‚Äî Klase han Kolateral</span></label>
          <div class="check-grid">
            <label class="check-item" onclick="handleCheckToggle(this,'secured-col-checks',true); toggleTaxDecSection()">
              <input type="checkbox" name="collateral_type" value="real_property" id="secured-col-checks" />
              <div class="check-label">Real Property (Land/House) <span class="check-waray">Lote/Balay (Real Property)</span></div>
            </label>
            <label class="check-item" onclick="handleCheckToggle(this,'secured-col-checks',true); toggleTaxDecSection()">
              <input type="checkbox" name="collateral_type" value="vehicle" />
              <div class="check-label">Vehicle <span class="check-waray">Sasakyan</span></div>
            </label>
            <label class="check-item" onclick="handleCheckToggle(this,'secured-col-checks',true); toggleTaxDecSection()">
              <input type="checkbox" name="collateral_type" value="equipment" />
              <div class="check-label">Equipment / Machinery <span class="check-waray">Makinarya / Kagamitan</span></div>
            </label>
            <label class="check-item" onclick="handleCheckToggle(this,'secured-col-checks',true); toggleTaxDecSection()">
              <input type="checkbox" name="collateral_type" value="deposit" />
              <div class="check-label">Deposit Hold-out <span class="check-waray">Deposito (ipapabilin ha bangko)</span></div>
            </label>
            <label class="check-item" onclick="handleCheckToggle(this,'secured-col-checks',true); toggleTaxDecSection()">
              <input type="checkbox" name="collateral_type" value="taxdec" />
              <div class="check-label">Tax Declaration (Real Property) <span class="check-waray">Tax Dec (Para ha Lote/Balay)</span></div>
            </label>
            <label class="check-item" onclick="handleCheckToggle(this,'secured-col-checks',true); toggleTaxDecSection()">
              <input type="checkbox" name="collateral_type" value="others" />
              <div class="check-label">Others / Iba pa</div>
            </label>
          </div>
        </div>
        <div class="field">
          <label>Estimated Collateral Value (PHP) <span class="req">*</span></label>
          <input type="text" name="collateral_value" placeholder="e.g. 500,000" />
        </div>
        <div class="field">
          <label>Ownership <span class="req">*</span> <span class="label-waray">‚Äî Tag-iya</span></label>
          <select name="collateral_ownership">
            <option value="">Select...</option>
            <option>Owned by Applicant / Akon mismo</option>
            <option>Owned by Spouse / Asawa ko</option>
            <option>Owned by Family (with consent) / Pamilya (may pagtugot)</option>
            <option>Others / Iba pa</option>
          </select>
        </div>
        <div class="field full">
          <label>Collateral Location / Description <span class="req">*</span> <span class="label-waray">‚Äî Diin / ano an kolateral?</span></label>
          <textarea name="collateral_desc" placeholder="Describe location and physical details of collateral..."></textarea>
        </div>
      </div>

      <!-- TAX DEC SUB-SECTION (shows if Tax Dec selected) -->
      <div id="taxdec-section" style="display:none;margin-top:18px">
        <div class="section-toggle" onclick="toggleCollapsible('taxdec-body',this)">
          <span>üìÑ C1. Tax Declaration Details <span class="label-waray">‚Äî Detalye han Tax Dec</span></span>
          <span class="toggle-arrow">‚ñº</span>
        </div>
        <div class="collapsible open" id="taxdec-body">
          <div class="form-grid" style="margin-top:12px">
            <div class="field">
              <label>Tax Declaration No. <span class="req">*</span></label>
              <input type="text" name="taxdec_no_c" placeholder="e.g. TD-2024-XXXXX" />
            </div>
            <div class="field">
              <label>Year of Tax Declaration <span class="req">*</span></label>
              <input type="text" name="taxdec_year_c" placeholder="e.g. 2024" />
            </div>
            <div class="field full">
              <label>Declared Owner Name <span class="req">*</span> <span class="label-waray">‚Äî Ngaran han tag-iya ha Tax Dec</span></label>
              <input type="text" name="taxdec_owner_c" placeholder="Name as printed on Tax Dec" />
            </div>
            <div class="field">
              <label>Your relationship to owner <span class="label-waray">‚Äî Ano an imo relasyon?</span></label>
              <input type="text" name="taxdec_relation_c" placeholder="e.g. Self, Spouse, Parent..." />
            </div>
            <div class="field">
              <label>Property Type <span class="req">*</span></label>
              <select name="taxdec_proptype_c">
                <option value="">Select...</option>
                <option>Land / Lote</option>
                <option>Building / House ‚Äî Balay/Building</option>
                <option>Land & Building ‚Äî Lote ngan Balay</option>
              </select>
            </div>
            <div class="field">
              <label>Assessed Value (PHP) <span class="req">*</span></label>
              <input type="text" name="taxdec_assessed_c" placeholder="From Tax Dec document" />
            </div>
            <div class="field">
              <label>Market Value (PHP) <span class="label-waray">‚Äî (optional)</span></label>
              <input type="text" name="taxdec_market_c" placeholder="Estimated market value" />
            </div>
            <div class="field full">
              <label>Property Address <span class="req">*</span></label>
              <input type="text" name="taxdec_address_c" placeholder="Location of the property" />
            </div>
          </div>
          <div style="margin-top:16px">
            <label style="font-size:13px;font-weight:600;margin-bottom:8px;display:block">Upload Tax Declaration <span class="req">*</span></label>
            <div class="upload-box">
              <input type="file" multiple accept="image/*,.pdf" onchange="handleFiles(this,'taxdec-files-c','taxdec-box-c')" />
              <div class="upload-icon">üìÑ</div>
              <p><strong>Upload Tax Dec document(s)</strong></p>
              <p>PDF or image accepted</p>
            </div>
            <div class="file-list" id="taxdec-files-c"></div>
          </div>
          <div style="margin-top:12px">
            <label style="font-size:13px;font-weight:600;margin-bottom:8px;display:block">Upload RPT Receipt <span class="label-waray">‚Äî (if available / kun mayda)</span></label>
            <div class="upload-box">
              <input type="file" multiple accept="image/*,.pdf" onchange="handleFiles(this,'rpt-files-c','rpt-box-c')" />
              <div class="upload-icon">üßæ</div>
              <p><strong>Real Property Tax receipt / proof of payment</strong></p>
            </div>
            <div class="file-list" id="rpt-files-c"></div>
          </div>
          <div style="margin-top:12px">
            <label style="font-size:13px;font-weight:600;margin-bottom:8px;display:block">Upload Property Photos <span class="req">*</span> <span class="label-waray">‚Äî Litrato han propiedad</span></label>
            <div class="upload-box">
              <input type="file" multiple accept="image/*" onchange="handleFiles(this,'prop-photos-c','prop-box-c')" />
              <div class="upload-icon">üì∑</div>
              <p><strong>Front, sides, interior if applicable</strong></p>
            </div>
            <div class="file-list" id="prop-photos-c"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- UNSECURED SECTION -->
    <div id="unsecured-section" style="display:none">
      <div class="callout">
        <strong>üìã Unsecured Loan Section</strong> ‚Äî Fill out income information for evaluation.<br/>
        <span class="label-waray">D. Detalye han Waray Kolateral ‚Äî Pleteha an imo impormasyon han kita.</span>
      </div>
      <div class="form-grid">
        <div class="field full">
          <label>Borrower Type <span class="req">*</span> <span class="label-waray">‚Äî Klase han aplikante</span></label>
          <div class="check-grid">
            <label class="check-item" onclick="handleCheckToggle(this,'borrower-type',true)">
              <input type="checkbox" name="borrower_type" value="employed" />
              <div class="check-label">Employed <span class="check-waray">May trabaho (empleyado)</span></div>
            </label>
            <label class="check-item" onclick="handleCheckToggle(this,'borrower-type',true)">
              <input type="checkbox" name="borrower_type" value="self_employed" />
              <div class="check-label">Self-Employed / Business <span class="check-waray">Negosyante / self-employed</span></div>
            </label>
            <label class="check-item" onclick="handleCheckToggle(this,'borrower-type',true)">
              <input type="checkbox" name="borrower_type" value="farmer" />
              <div class="check-label">Farmer / Fisherfolk <span class="check-waray">Parag-uma / Paraisda</span></div>
            </label>
            <label class="check-item" onclick="handleCheckToggle(this,'borrower-type',true)">
              <input type="checkbox" name="borrower_type" value="ofw" />
              <div class="check-label">OFW <span class="check-waray">Overseas Filipino Worker</span></div>
            </label>
          </div>
        </div>
        <div class="field">
          <label>Estimated Monthly Income (PHP) <span class="req">*</span> <span class="label-waray">‚Äî Bulanan nga kita</span></label>
          <input type="text" name="monthly_income" placeholder="e.g. 25,000" />
        </div>
        <div class="field">
          <label>Employer / Business Name <span class="req">*</span></label>
          <input type="text" name="employer" placeholder="Company or business name" />
        </div>
        <div class="field full">
          <label>Income Details <span class="label-waray">‚Äî (optional / Dugang detalye han kita)</span></label>
          <textarea name="income_details" placeholder="Additional income information, other sources, etc."></textarea>
        </div>
      </div>

      <!-- OPTIONAL TAX DEC SUPPORT -->
      <div style="margin-top:18px">
        <div class="section-toggle" onclick="toggleCollapsible('taxdec-unsec-body',this)">
          <span>üìÑ D1. Optional Tax Declaration Support <span class="label-waray">‚Äî Opsyonal nga suporta</span></span>
          <span class="toggle-arrow">‚ñº</span>
        </div>
        <div class="collapsible open" id="taxdec-unsec-body">
          <div style="margin-top:12px" class="callout">
            <strong>‚ÑπÔ∏è</strong> A Tax Declaration can be submitted as additional support for evaluation ‚Äî it is NOT used as collateral here.<br/>
            <span class="label-waray">May Tax Dec ako nga mapapakita para suportahan an evaluation (diri ini kolateral).</span>
          </div>
          <div class="form-grid" style="margin-top:12px">
            <div class="field">
              <label>Tax Declaration No.</label>
              <input type="text" name="taxdec_no_d" placeholder="e.g. TD-2024-XXXXX" />
            </div>
            <div class="field">
              <label>Year of Tax Declaration</label>
              <input type="text" name="taxdec_year_d" placeholder="e.g. 2024" />
            </div>
            <div class="field full">
              <label>Declared Owner Name <span class="label-waray">‚Äî Ngaran han tag-iya ha Tax Dec</span></label>
              <input type="text" name="taxdec_owner_d" placeholder="Name as printed on Tax Dec" />
            </div>
            <div class="field">
              <label>Property Type</label>
              <select name="taxdec_proptype_d">
                <option value="">Select...</option>
                <option>Land / Lote</option>
                <option>Building / House</option>
                <option>Land & Building</option>
              </select>
            </div>
            <div class="field">
              <label>Assessed Value (PHP)</label>
              <input type="text" name="taxdec_assessed_d" placeholder="From Tax Dec document" />
            </div>
            <div class="field">
              <label>Market Value (PHP)</label>
              <input type="text" name="taxdec_market_d" placeholder="Estimated" />
            </div>
            <div class="field full">
              <label>Property Address</label>
              <input type="text" name="taxdec_address_d" placeholder="Location of the property" />
            </div>
          </div>
          <div style="margin-top:14px">
            <label style="font-size:13px;font-weight:600;margin-bottom:8px;display:block">Upload Tax Declaration <span class="label-waray">‚Äî (optional)</span></label>
            <div class="upload-box">
              <input type="file" multiple accept="image/*,.pdf" onchange="handleFiles(this,'taxdec-files-d','taxdec-box-d')" />
              <div class="upload-icon">üìÑ</div>
              <p><strong>Upload Tax Dec document(s)</strong></p>
            </div>
            <div class="file-list" id="taxdec-files-d"></div>
          </div>
          <div style="margin-top:12px">
            <label style="font-size:13px;font-weight:600;margin-bottom:8px;display:block">Upload RPT Receipt <span class="label-waray">‚Äî (if available)</span></label>
            <div class="upload-box">
              <input type="file" multiple accept="image/*,.pdf" onchange="handleFiles(this,'rpt-files-d','rpt-box-d')" />
              <div class="upload-icon">üßæ</div>
              <p><strong>Real Property Tax receipt</strong></p>
            </div>
            <div class="file-list" id="rpt-files-d"></div>
          </div>
          <div style="margin-top:12px">
            <label style="font-size:13px;font-weight:600;margin-bottom:8px;display:block">Upload Property Photos <span class="label-waray">‚Äî (optional)</span></label>
            <div class="upload-box">
              <input type="file" multiple accept="image/*" onchange="handleFiles(this,'prop-photos-d','prop-box-d')" />
              <div class="upload-icon">üì∑</div>
              <p><strong>Photos of the property</strong></p>
            </div>
            <div class="file-list" id="prop-photos-d"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="nav-row">
      <button type="button" class="btn btn-ghost" onclick="prevStep(2)">‚Üê Back</button>
      <button type="button" class="btn btn-primary" onclick="nextStep(2)">Next: Documents ‚Üí</button>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ STEP 4: DOCUMENTARY REQUIREMENTS ‚îÄ‚îÄ -->
  <div class="card" id="step-3">
    <div class="card-header">
      <div class="card-icon">üìÅ</div>
      <div>
        <h2>E. Documentary Requirements</h2>
        <p class="label-waray">Mga Kinahanglan nga Dokumento (Giya)</p>
      </div>
    </div>

    <div class="callout">
      <strong>üìå This section is a checklist guide</strong> ‚Äî review what you need to prepare before submitting.<br/>
      <span class="label-waray">Basaha ini para malaman mo kung ano an mga kinahanglan nga dokumento.</span>
    </div>

    <div class="section-toggle" onclick="toggleCollapsible('common-docs',this)">
      <span>üìã Common Requirements <span class="label-waray">‚Äî Para ha ngatanan nga loan</span></span>
      <span class="toggle-arrow open">‚ñ≤</span>
    </div>
    <div class="collapsible open" id="common-docs">
      <ul class="doc-list" style="margin-top:12px;margin-bottom:16px">
        <li>Valid Government ID (at least 1) <span class="doc-waray">Valid nga government ID (bisan usa la)</span></li>
        <li>Proof of Address (Brgy. Certificate or Utility Bill if available) <span class="doc-waray">Proba han address (Brgy. Certificate / bill kun mayda)</span></li>
        <li>Birth Certificate (if required) <span class="doc-waray">Birth Certificate (kun kinahanglan)</span></li>
      </ul>
    </div>

    <div class="section-toggle" onclick="toggleCollapsible('secured-docs',this)" style="margin-top:10px">
      <span>üè† Secured Loan Requirements <span class="label-waray">‚Äî May Kolateral</span></span>
      <span class="toggle-arrow open">‚ñ≤</span>
    </div>
    <div class="collapsible open" id="secured-docs">
      <ul class="doc-list" style="margin-top:12px;margin-bottom:16px">
        <li>Collateral documents (depends on type) <span class="doc-waray">Mga papeles han kolateral (depende ha klase)</span></li>
        <li>Tax Declaration copy <span class="doc-waray">Kopya han Tax Dec</span></li>
        <li>Latest RPT official receipt (if available) <span class="doc-waray">Pinakabag-o nga RPT resibo (kun mayda)</span></li>
        <li>IDs of owner/s and borrower <span class="doc-waray">ID han tag-iya ngan nanguutang</span></li>
        <li>SPA if borrower is not the declared owner <span class="doc-waray">SPA kun diri an nanguutang an nakapangaran</span></li>
        <li>Extrajudicial Settlement or Deed of Sale (if applicable) <span class="doc-waray">Extrajudicial settlement o Deed of Sale (kun kinahanglan)</span></li>
      </ul>
    </div>

    <div class="section-toggle" onclick="toggleCollapsible('unsecured-docs',this)" style="margin-top:10px">
      <span>üíº Unsecured Loan Requirements <span class="label-waray">‚Äî Waray Kolateral</span></span>
      <span class="toggle-arrow open">‚ñ≤</span>
    </div>
    <div class="collapsible open" id="unsecured-docs">
      <ul class="doc-list" style="margin-top:12px;margin-bottom:16px">
        <li>Proof of Income: payslip / COE OR business permit / sales record OR farm record <span class="doc-waray">Proba han kita: payslip/COE O business permit/sales record O farm record</span></li>
        <li>Tax Declaration copy (if providing as support) <span class="doc-waray">Kopya han Tax Dec (kun mapapakita bilang suporta)</span></li>
        <li>Latest RPT official receipt (if available) <span class="doc-waray">Pinakabag-o nga RPT resibo (kun mayda)</span></li>
      </ul>
    </div>

    <!-- INCOME PROOF UPLOAD -->
    <div style="margin-top:18px">
      <label style="font-size:14px;font-weight:600;margin-bottom:10px;display:block">Upload Proof of Income / Supporting Documents <span class="label-waray">‚Äî Proba han Kita</span></label>
      <div class="upload-box">
        <input type="file" multiple accept="image/*,.pdf" onchange="handleFiles(this,'income-files','income-box')" />
        <div class="upload-icon">üìä</div>
        <p><strong>Payslip, COE, Business Permit, or Farm Record</strong></p>
        <p>Upload any relevant proof of income or capacity to pay</p>
      </div>
      <div class="file-list" id="income-files"></div>
    </div>

    <div class="nav-row">
      <button type="button" class="btn btn-ghost" onclick="prevStep(3)">‚Üê Back</button>
      <button type="button" class="btn btn-primary" onclick="nextStep(3)">Next: Consent & Submit ‚Üí</button>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ STEP 5: CONSENT & SUBMIT ‚îÄ‚îÄ -->
  <div class="card" id="step-4">
    <div class="card-header">
      <div class="card-icon">‚úçÔ∏è</div>
      <div>
        <h2>F. Consent & Submission</h2>
        <p class="label-waray">Pagsugot ngan Pagpadala</p>
      </div>
    </div>

    <div class="callout">
      <strong>Data Privacy Notice:</strong> Your personal information will be collected and processed solely for loan evaluation and contact purposes, in accordance with the Data Privacy Act of 2012 (R.A. 10173).<br/>
      <span class="label-waray">An imo personal nga impormasyon gamiton la para ha loan evaluation ngan pakigkontak, subay han Data Privacy Act.</span>
    </div>

    <div class="check-grid" style="margin-bottom:20px">
      <label class="check-item" onclick="handleCheckToggle(this,'consent-checks',true)">
        <input type="checkbox" id="consent1" name="consent" value="en" required />
        <div class="check-label">I consent to the collection and processing of my personal data for loan evaluation and contact purposes.</div>
      </label>
      <label class="check-item" onclick="handleCheckToggle(this,'consent-checks',true)">
        <input type="checkbox" id="consent2" name="consent" value="war" required />
        <div class="check-label">Nauyon ako nga kolektahon ngan gamiton an akon data para ha loan evaluation ngan pakigkontak.</div>
      </label>
    </div>

    <div class="form-grid">
      <div class="field">
        <label>Applicant Full Name (Signature) <span class="req">*</span> <span class="label-waray">‚Äî Pirma / Ngaran</span></label>
        <input type="text" name="signature" placeholder="Type your full legal name" required />
      </div>
      <div class="field">
        <label>Date <span class="req">*</span> <span class="label-waray">‚Äî Petsa</span></label>
        <input type="text" name="sign_date" id="sign-date" placeholder="YYYY-MM-DD" required />
      </div>
    </div>

    <!-- Summary Review -->
    <div style="margin-top:24px; background:var(--green-light); border:1.5px solid var(--green); border-radius:14px; padding:18px;">
      <h3 style="font-family:'DM Serif Display',serif; font-size:16px; color:var(--green); margin-bottom:12px;">üìã Application Summary</h3>
      <div id="summary-content" style="font-size:13.5px; line-height:2; color:var(--text);">
        <em style="color:var(--muted)">Please complete the previous steps to see your summary here.</em>
      </div>
    </div>

    <div class="nav-row">
      <button type="button" class="btn btn-ghost" onclick="prevStep(4)">‚Üê Back</button>
      <button type="button" class="btn btn-gold" onclick="submitForm()">üè¶ Submit Loan Inquiry ‚Üí</button>
    </div>
  </div>

  </form>

  <!-- ‚îÄ‚îÄ SUCCESS ‚îÄ‚îÄ -->
  <div id="success-screen">
    <div class="success-icon">‚úÖ</div>
    <h2>Loan Inquiry Submitted!</h2>
    <p>Thank you for submitting your loan inquiry to Rural Bank of Calbayog City, Inc. Our loan officer will review your application and contact you via Messenger within 1‚Äì3 banking days.</p>
    <p class="label-waray" style="margin-top:8px;font-size:13px;color:var(--muted)">Salamat ha pagpadala han imo loan inquiry. An amon loan officer makigkontak ha iyo pinaagi ha Messenger sulod 1‚Äì3 nga adlaw ha trabaho.</p>

    <div class="ref-number" id="ref-number">REF-2026-XXXXX</div>

    <!-- SAVE REF REMINDER -->
    <div style="background:#fff8e1;border:1px solid #ffe082;border-radius:12px;padding:14px 20px;max-width:460px;margin:0 auto 24px;font-size:13px;color:#7d5a00;line-height:1.6;">
      <strong>üìå Important:</strong> Please <strong>save or take a screenshot</strong> of your Reference Number above.<br/>
      You will need it to fill out the <strong>Full Loan Application Form</strong>.<br/>
      <span style="font-style:italic;color:#a07820;">Palihog i-save an imo Reference Number. Kinahanglan mo ini para makompleto an Loan Application Form.</span>
    </div>

    <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-bottom:12px">
      <!-- MAIN CTA: Proceed to Application -->
      <button class="btn btn-gold" onclick="proceedToApplication()" style="font-size:15px;padding:14px 28px;">
        üìã Proceed to Full Application ‚Üí
      </button>
    </div>
    <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap">
      <button class="btn btn-primary" onclick="window.print()">üñ®Ô∏è Print / Save Copy</button>
      <button class="btn btn-ghost" onclick="resetForm()">Submit Another Inquiry</button>
    </div>
  </div>

</div><!-- /main -->

<script>
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
//  STATE
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let currentStep = 0;
const totalSteps = 5;

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
//  INIT
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
window.addEventListener('DOMContentLoaded', () => {
  // Set today's date
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('sign-date').value = today;
  updateProgress();

  // Show secured section by default
  document.getElementById('secured-section').style.display = 'block';
});

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
//  STEP NAVIGATION
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function goToStep(n) {
  document.getElementById(`step-${currentStep}`).classList.remove('active');
  currentStep = n;
  document.getElementById(`step-${currentStep}`).classList.add('active');
  updateProgress();
  if (n === 4) buildSummary();
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function nextStep(from) {
  if (from < totalSteps - 1) goToStep(from + 1);
}
function prevStep(from) {
  if (from > 0) goToStep(from - 1);
}

function updateProgress() {
  const pills = document.querySelectorAll('.step-pill');
  const lines = document.querySelectorAll('.step-line');
  pills.forEach((p, i) => {
    p.classList.remove('active', 'done');
    if (i === currentStep) p.classList.add('active');
    else if (i < currentStep) p.classList.add('done');
  });
  lines.forEach((l, i) => {
    l.classList.toggle('done', i < currentStep);
  });
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
//  LOAN TYPE TOGGLE
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleSections() {
  const radios = document.querySelectorAll('input[name="loan_type"]');
  let selected = '';
  radios.forEach(r => { if (r.checked) selected = r.value; });
  document.getElementById('secured-section').style.display = selected === 'secured' ? 'block' : 'none';
  document.getElementById('unsecured-section').style.display = selected === 'unsecured' ? 'block' : 'none';
}

function toggleTaxDecSection() {
  setTimeout(() => {
    const taxDecChecked = document.querySelector('input[value="taxdec"]:checked');
    document.getElementById('taxdec-section').style.display = taxDecChecked ? 'block' : 'none';
  }, 50);
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
//  CHECKBOX STYLING
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function handleCheckToggle(label, groupId, multi) {
  setTimeout(() => {
    const container = label.closest('.check-grid') || document;
    const inputs = container.querySelectorAll('input[type="checkbox"], input[type="radio"]');
    if (!multi) {
      // radio-style: uncheck others
      inputs.forEach(inp => {
        inp.closest('.check-item')?.classList.remove('checked');
      });
    }
    inputs.forEach(inp => {
      if (inp.checked) inp.closest('.check-item')?.classList.add('checked');
      else inp.closest('.check-item')?.classList.remove('checked');
    });
  }, 30);
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
//  COLLAPSIBLE
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleCollapsible(id, toggleEl) {
  const el = document.getElementById(id);
  const arrow = toggleEl.querySelector('.toggle-arrow');
  el.classList.toggle('open');
  arrow.classList.toggle('open');
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
//  FILE UPLOAD
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function handleFiles(input, listId, boxId) {
  const list = document.getElementById(listId);
  Array.from(input.files).forEach(file => {
    const tag = document.createElement('div');
    tag.className = 'file-tag';
    tag.innerHTML = `üìé ${file.name} <button onclick="this.parentElement.remove()">√ó</button>`;
    list.appendChild(tag);
  });
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
//  SUMMARY
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function buildSummary() {
  const g = name => {
    const el = document.querySelector(`[name="${name}"]`);
    return el ? el.value || '‚Äî' : '‚Äî';
  };
  const loanType = document.querySelector('input[name="loan_type"]:checked');
  const html = `
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px 24px">
      <div><strong>Name:</strong> ${g('full_name')}</div>
      <div><strong>Mobile:</strong> ${g('mobile')}</div>
      <div><strong>Email:</strong> ${g('email') || '(not provided)'}</div>
      <div><strong>Messenger:</strong> ${g('messenger')}</div>
      <div style="grid-column:1/-1"><strong>Address:</strong> ${g('address')}</div>
      <div><strong>Loan Type:</strong> ${loanType ? (loanType.value === 'secured' ? 'Secured (With Collateral)' : 'Unsecured (No Collateral)') : '‚Äî'}</div>
      <div><strong>Amount:</strong> PHP ${g('loan_amount')}</div>
      <div><strong>Term:</strong> ${g('loan_term')}</div>
      <div><strong>Purpose:</strong> ${g('loan_purpose')}</div>
    </div>
  `;
  document.getElementById('summary-content').innerHTML = html;
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
//  SUBMIT
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
//  GOOGLE SHEETS INTEGRATION
//  Replace the URL below with your Google Apps Script Web App URL
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzCG23qrxAPDKB1LEhb_qFWrDkyCv9MKa-lvn65pvwUKdSSuZQKAzTMdR_r6wu92L2T/exec';

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
//  FILE 2 (LOAN APPLICATION) URL
//  Set this to your deployed FILE 2 URL on Railway
//  e.g. 'https://your-app.up.railway.app/application.html'
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const LOAN_APPLICATION_URL = 'https://trial-loan-inquiry-application-production.up.railway.app/application.html';

function collectFormData() {
  const g = name => {
    const el = document.querySelector(`[name="${name}"]`);
    return el ? (el.value || '') : '';
  };
  const loanTypeEl = document.querySelector('input[name="loan_type"]:checked');
  const loanType = loanTypeEl ? (loanTypeEl.value === 'secured' ? 'Secured (With Collateral)' : 'Unsecured (No Collateral)') : '';

  // Collect checked collateral types
  const collateralChecks = document.querySelectorAll('input[name="collateral_type[]"]:checked, input[name="collateral_type"]:checked');
  const collateralTypes = Array.from(collateralChecks).map(c => c.value).join(', ');

  // Collect checked income sources
  const incomeChecks = document.querySelectorAll('input[name="income_source[]"]:checked, input[name="income_source"]:checked');
  const incomeSources = Array.from(incomeChecks).map(c => c.value).join(', ');

  // Collect checked documents
  const docChecks = document.querySelectorAll('input[name="documents[]"]:checked, input[name="documents"]:checked');
  const documents = Array.from(docChecks).map(c => c.value).join(', ');

  return {
    timestamp: new Date().toISOString(),
    full_name: g('full_name'),
    mobile: g('mobile'),
    email: g('email'),
    address: g('address'),
    messenger: g('messenger'),
    loan_type: loanType,
    loan_amount: g('loan_amount'),
    loan_term: g('loan_term'),
    loan_purpose: g('loan_purpose'),
    referral: g('referral'),
    collateral_types: collateralTypes,
    property_location: g('property_location'),
    property_area: g('property_area'),
    tax_dec_no: g('tax_dec_no'),
    income_sources: incomeSources,
    monthly_income: g('monthly_income'),
    employer_business: g('employer_business'),
    documents_submitted: documents,
    signature: g('signature'),
    sign_date: g('sign-date') || g('sign_date'),
  };
}

async function submitForm() {
  const consent1 = document.getElementById('consent1');
  const consent2 = document.getElementById('consent2');
  if (!consent1.checked || !consent2.checked) {
    alert('Please check both consent boxes to proceed.\n\nPalihog i-check an duha nga kahon para makasumite.');
    return;
  }
  const sig = document.querySelector('[name="signature"]').value;
  if (!sig.trim()) {
    alert('Please type your full name as signature.\n\nIsulat an imo buong ngaran bilang pirma.');
    return;
  }

  // Generate reference number
  const ref = 'REF-2026-' + Math.random().toString(36).toUpperCase().slice(2,7);

  // Show loading state
  const submitBtn = document.querySelector('#step-4 .btn-gold, #step-4 .btn-primary');
  const origText = submitBtn ? submitBtn.innerHTML : '';
  if (submitBtn) {
    submitBtn.disabled = true;
    submitBtn.innerHTML = '‚è≥ Submitting...';
  }

  try {
    const formData = collectFormData();
    formData.reference_number = ref;

    await fetch(GOOGLE_SCRIPT_URL, {
      method: 'POST',
      mode: 'no-cors',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(formData)
    });

    // Show success screen
    document.querySelector('.progress-bar-wrap').style.display = 'none';
    document.getElementById('main-form').style.display = 'none';
    document.getElementById('success-screen').style.display = 'block';
    document.getElementById('ref-number').textContent = ref;
  } catch (e) {
    // Even on network error (no-cors mode), show success if URL is configured
    if (GOOGLE_SCRIPT_URL !== 'https://script.google.com/macros/s/AKfycbytmvWVXT4gMx_qUYJSsndZ8c_ru8wh6nXwlO7hzrgOiBTLwM14qcpXmzg7aiVf6Cfh0Q/exec') {
      document.querySelector('.progress-bar-wrap').style.display = 'none';
      document.getElementById('main-form').style.display = 'none';
      document.getElementById('success-screen').style.display = 'block';
      document.getElementById('ref-number').textContent = ref;
    } else {
      alert('‚ö†Ô∏è Google Sheets is not yet connected. Please set up your Apps Script URL first.\n\nSee the setup instructions in the HTML file comments.');
      if (submitBtn) {
        submitBtn.disabled = false;
        submitBtn.innerHTML = origText;
      }
    }
  }
}

function resetForm() {
  document.querySelector('.progress-bar-wrap').style.display = '';
  document.getElementById('main-form').style.display = '';
  document.getElementById('success-screen').style.display = 'none';
  document.getElementById('main-form').reset();
  goToStep(0);
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
//  AI ASSISTANT
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const chatArea = document.getElementById('chat-area');

function addBubble(text, role) {
  chatArea.classList.add('visible');
  const div = document.createElement('div');
  div.className = `bubble ${role}`;
  div.innerHTML = text;
  chatArea.appendChild(div);
  div.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  return div;
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
//  PROCEED TO FILE 2 (LOAN APPLICATION)
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function proceedToApplication() {
  const ref = document.getElementById('ref-number').textContent;
  if (!ref || ref === 'REF-2026-XXXXX') {
    alert('Reference number not found. Please submit the inquiry form first.');
    return;
  }
  if (LOAN_APPLICATION_URL === 'YOUR_FILE2_RAILWAY_URL_HERE') {
    alert('‚ö†Ô∏è Loan Application URL is not yet configured.\n\nPlease set LOAN_APPLICATION_URL in the script to your FILE 2 Railway URL.');
    return;
  }
  // Open FILE 2 with the reference number as a URL parameter
  window.open(LOAN_APPLICATION_URL + '?ref=' + encodeURIComponent(ref), '_blank');
}

async function sendAI() {
  const input = document.getElementById('ai-input');
  const q = input.value.trim();
  if (!q) return;
  input.value = '';

  addBubble(q, 'user');

  const thinking = addBubble('<div class="dots"><span></span><span></span><span></span></div> Thinking...', 'thinking');

  try {
    const res = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 1000,
        system: `You are a helpful loan assistant for the Rural Bank of Calbayog City, Inc. (RBCCI) in the Philippines. 
You help applicants understand the loan inquiry process. The bank offers Secured Loans (with collateral: real property, vehicle, equipment, deposit hold-out, or Tax Declaration) and Unsecured Loans (based on income). 
Tax Declarations are accepted as collateral for secured loans, or as supporting documents for unsecured loans.
Required documents for all loans: valid government ID, proof of address, birth certificate if required.
For secured loans: collateral documents, Tax Dec copy, RPT receipt, IDs of owner and borrower, SPA if needed.
For unsecured loans: proof of income (payslip/COE, business permit, farm record).
The bank contacts applicants via Facebook Messenger. Keep answers concise, helpful, and friendly. Use simple English. Occasionally add Waray (Calbayog-Samar tone) phrases like "Salamat!" or "Waray problema!" to be warm and relatable.`,
        messages: [{ role: 'user', content: q }]
      })
    });
    const data = await res.json();
    thinking.remove();
    const reply = data.content?.map(c => c.text || '').join('') || 'Sorry, I could not get a response. Please try again.';
    addBubble(reply.replace(/\n/g, '<br/>'), 'ai');
  } catch (e) {
    thinking.remove();
    addBubble('Sorry, the AI assistant is temporarily unavailable. Please continue filling out the form or contact the bank directly.', 'ai');
  }
}
</script>
</body>
</html>
